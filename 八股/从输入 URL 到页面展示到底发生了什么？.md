## 从输入 URL 到页面展示到底发生了什么？
## 基本答案
输入网址，解析URL信息，准备发送HTTP请求
检查浏览器缓存里是否有缓存该资源，如果有直接返回；如果没有进入下一步网络请求。
DNS域名解析：网络请求前，进行DNS解析，以获取请求域名的IP地址。DNS解析时会按本地浏览器缓存->本地Host文件->路由器缓存->DNS服务器->根DNS服务器的顺序查询域名对应IP，直到找到为止。
TCP三次握手建立连接：浏览器与服务器IP建立TCP连接。
客户端发送HTTP请求：连接建立后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的Cookie等数据附加到请求头中，向服务器构建请求信息。如果是HTTPS的话，还涉及到HTTPS的加解密流程。
服务器处理请求并返回HTTP资源：服务器接收到请求信息，根据请求生成响应数据。
TCP四次挥手断开连接：浏览器与服务器IP断开TCP连接。
浏览器解析响应并渲染页面：
浏览器解析响应头。若响应头状态码为301、302，会重定向到新地址；若响应数据类型是字节流类型，一般会将请求提交给下载管理器；若是HTML类型，会进入下一部渲染流程。
浏览器解析HTML文件，创建DOM树，解析CSS进行样式计算，然后将CSS和DOM合并，构建渲染树；最后布局和绘制渲染树，完成页面展示。

---
## 详细答案

## **1. 用户输入 URL 并解析信息**

1. 用户在浏览器地址栏输入 URL，例如 `https://www.example.com/index.html`。
2. 浏览器会解析 URL：

   * 协议（scheme）：`https` → 确定使用 HTTPS 协议
   * 域名（host）：`www.example.com` → 用于 DNS 解析
   * 端口（port）：默认 443（HTTPS）或 80（HTTP）
   * 路径（path）：`/index.html` → 请求具体资源
   * 查询参数（query）：如果有 `?id=123`
   * 锚点（fragment）：`#section1`，一般不会发送给服务器
3. 浏览器根据 URL 检查 **缓存**：

   * 浏览器缓存、Service Worker 缓存
   * 如果资源在缓存中且未过期，直接返回缓存内容 → 页面显示
   * 否则进入网络请求流程

---

## **2. DNS 域名解析**

1. 浏览器需要把域名解析为 IP 地址才能发送请求：

   * 查询顺序：

     1. 浏览器内部 DNS 缓存
     2. 本地 hosts 文件
     3. 路由器/本地 DNS 缓存
     4. 上游 DNS 服务器（ISP 提供）
     5. 根 DNS → 顶级域名服务器 → 权威 DNS 服务器
2. 最终获得目标服务器的 IP 地址，用于建立 TCP 连接

> **面试提示**：可以说 DNS 本质上是“将域名映射为 IP 地址”的过程，并且是网络请求的第一步。

---

## **3. TCP 连接（三次握手）**

1. 浏览器使用 TCP 协议与服务器 IP 建立连接：

   * **SYN**：客户端发送 SYN（同步）报文请求建立连接
   * **SYN-ACK**：服务器收到 SYN 后返回确认报文
   * **ACK**：客户端收到确认后再发送确认报文
2. 连接建立成功后，浏览器可以发送数据
3. 如果使用 HTTPS，还会在 TCP 之上进行 **TLS/SSL 握手**：

   * 协商加密算法、交换公钥证书
   * 生成对称加密密钥
   * 后续数据传输使用对称加密保证安全

---

## **4. 发送 HTTP/HTTPS 请求**

1. 浏览器构建请求报文：

   * 请求行：`GET /index.html HTTP/1.1`
   * 请求头：包括 Host、User-Agent、Cookie、Referer 等
   * 请求体（如果有，比如 POST 请求）
2. 浏览器将请求发送到服务器对应 IP 的端口（HTTP 80/HTTPS 443）
3. HTTPS 请求先经过 TLS 加密后再发送

> **面试提示**：可以强调 **浏览器会带 Cookie、缓存验证信息（If-Modified-Since/ETag）**，以便服务器判断资源是否更新。

---

## **5. 服务器处理请求并返回响应**

1. 服务器收到请求，经过：

   * Web 服务器（如 Nginx、Apache）
   * 应用程序（如 Node.js、Django）
2. 生成响应：

   * 状态码：200（成功）、301/302（重定向）、404（未找到）、500（服务器错误）
   * 响应头：Content-Type、Cache-Control、Set-Cookie、Content-Length 等
   * 响应体：HTML、CSS、JS、图片等资源
3. 响应数据通过 TCP 返回给浏览器

---

## **6. TCP 断开连接（四次挥手）**

1. 浏览器与服务器传输完毕后关闭连接：

   * 客户端发送 FIN → 服务器 ACK → 服务器 FIN → 客户端 ACK
2. 保证数据完整传输，避免半关闭状态
3. HTTP/1.1 支持 **长连接**（Keep-Alive），可以复用 TCP 连接

---

## **7. 浏览器解析响应并渲染页面**

### **7.1 解析响应头**

* 检查状态码：

  * 301/302 → 浏览器重定向到新地址
  * 200 → 正常处理
* 检查 Content-Type：

  * HTML → 渲染
  * 图片/视频 → 交给渲染引擎或下载管理器
* 检查缓存控制头（Cache-Control、ETag、Last-Modified）

### **7.2 构建 DOM 和 CSSOM**

1. 浏览器解析 HTML → 构建 **DOM 树**
2. 解析 CSS → 构建 **CSSOM 树**
3. 将 DOM + CSSOM 合并 → **渲染树**

### **7.3 布局与绘制**

1. **布局（Layout / Reflow）**：计算每个节点的大小和位置
2. **绘制（Paint）**：将每个节点绘制到屏幕上
3. **合成（Composite）**：合成图层，最终显示在页面

### **7.4 执行 JavaScript**

* JS 可以操作 DOM/CSSOM → 导致重新布局或重绘
* 浏览器会阻塞解析 HTML，直到关键 JS 执行完成（script 标签默认阻塞）

---

## **8. 总结流程图（面试可口头描述）**

```
输入 URL
    ↓
浏览器解析 URL
    ↓
检查缓存（浏览器/Service Worker）
    ↓
DNS 域名解析 → 获得 IP
    ↓
TCP 三次握手（建立连接）
    ↓
发送 HTTP/HTTPS 请求
    ↓
服务器处理请求 → 返回 HTTP 响应
    ↓
TCP 四次挥手（断开连接）
    ↓
浏览器解析响应头
    ↓
构建 DOM / CSSOM / 渲染树
    ↓
布局（Layout） + 绘制（Paint） + 合成（Composite）
    ↓
页面展示
```
